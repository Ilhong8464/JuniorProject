<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>detail</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/css/styles/kendo.common.min.css" />
    <link rel="stylesheet" href="/css/styles/kendo.default.min.css" />
    <link rel="stylesheet" href="/css/styles/kendo.default.mobile.min.css" />
    <link rel="stylesheet" href="/css/styles/kendo.rtl.min.css" />
    <link rel="stylesheet" href="/css/styles/examples-offline.css" />

    <script src="/js/ui/jquery.min.js"></script>
    <script src="/js/ui/kendo.all.min.js"></script>
    <script src="/js/ui/jszip.min.js"></script>
    <script src="/js/ui/console.js"></script>
</head>
<body>
<header style="width: 100%">
    <div id="appbar" style="height: 15%; margin-bottom: 15px"></div>
</header>
<section>
    <div class="demo-section wide" style="width: 80%; height: 800px;">
        <input type="hidden" id="free-board-detail-board-num" name="boardNum">
        <input type="hidden" id="free-board-detail-user-num" name="userIdx">
        <div style="flex-flow: column; width: 100%">
            <div class="pop-k-header k-card-header">
                <div>
                    <h3 id="free-board-detail-popup-title"></h3>
                </div>
            </div>
            <div class="k-card-body">
                <div class="k-card-header">
                    <h4 id="free-board-detail-title"></h4>
                </div>
                <div id="free-board-detail-body-splitter" class="k-card-body">
                    <div id="detail-body-top-section" style="height: 83%; border-bottom: 1px solid rgb(222,226,230);">
                        <div id="free-board-detail-contents" style="height: 500px;"></div>
                    </div>
                    <div id="detail-body-bottom-section" style="height: 8%;">
                        <div style="display: table; width: 80%; table-layout: fixed; border-spacing: 5px;">
                            <div style="display: table-row">
                                <div style="display: table-cell; padding: 5px;">
                                    <dt>등록</dt>
                                    <dd><input id="free-board-detail-reg-date"/></dd>
                                </div>
                                <div style="display: table-cell; padding: 5px;">
                                    <dt>수정</dt>
                                    <dd><input id="free-board-detail-modi-date"/></dd>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="k-card-footer" style="height:40px; display: flex; justify-content: space-between;">
                <div style="padding: 5px">
                    <button id="free-board-detail-update-btn">수정</button>
                    <button id="free-board-detail-delete-btn">삭제</button>
                </div>
                <div style="padding: 5px;">
                    <button id="free-board-detail-like">추천</button>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        const message = {
            callBackConfirm: function(obj){
                let opt = $.extend({title: document.title, msg: '처리하겠습니까?', callback: ''}, obj);
                let $div = $('<div id="callBackConfirm"></div>');
                $('body').append($div);
                $($div).kendoDialog({
                    title: opt.title,
                    content: opt.msg,
                    minWidth: 300,
                    minHeight: 150,
                    closable: false,
                    actions: [
                        {text: '취소'},
                        {
                            text: '확인',
                            action: function () {
                                if (typeof opt.callback === 'function') {
                                    opt.callback.call();
                                }
                                return true;
                            },
                            primary: true
                        }
                    ],
                    close: function () {
                        $($div).data('kendoDialog').destroy();
                    }

                });
            }
        }
        $("#free-board-detail-popup-title").text('게시글 상세보기');
        var appbar = $("#appbar").kendoAppBar({
            themeColor: "inherit",
            items: [
                {
                    template: '<a id="logo" href="/board"> <img src="/images/centerlink.png" alt="logo" style="width: 100%"> </a>',
                    type: "contentItem"
                },

                { width: 1, type: "spacer"},
                {
                    template: '<button id="home-top-btn"></button>', type: "contentItem"
                },
                {width: 16, type: "spacer"}
            ]
        });
        $("#free-board-detail-body-splitter").kendoSplitter({
            orientation: 'vertical',
            panes: [
                {collapsible: false, resizable: false},
                {collapsible: false, size: '100px', resizable: false}
            ]
        });
        $("#free-board-detail-reg-date").kendoTextBox({
            fillMode: 'flat',
            readonly: true
        });
        $("#free-board-detail-modi-date").kendoTextBox({
            fillMode: 'flat',
            readonly: true
        });
        $("#free-board-detail-like").kendoButton({
            themeColor: 'base'
        })

        $("#free-board-detail-delete-btn").kendoButton({
            themeColor: 'base',
            click: () => {
                    message.callBackConfirm({msg: '삭제 하시겠습니까?', callback: new boardDel().deleteOne});
            }
        });
        $("#free-board-detail-update-btn").kendoButton({
            themeColor: 'info'
        });

        boardRegidate = kendo.toString(new Date([[${boardOne.boardRegidate}]]), "yyyy-MM-dd H:mm");
        boardModidate = kendo.toString(new Date([[${boardOne.boardModidate}]]), "yyyy-MM-dd H:mm");
        $("#free-board-detail-user-num").val([[${boardOne.member.userIdx}]])
        $("#free-board-detail-board-num").val([[${boardOne.boardNum}]]);
        $("#free-board-detail-title").text([[${boardOne.boardTitle}]]);
        $("#free-board-detail-contents").text([[${boardOne.boardContents}]]);
        $("#free-board-detail-reg-date").data("kendoTextBox").value(boardRegidate);
        $("#free-board-detail-modi-date").data("kendoTextBox").value(boardModidate);

        class boardDel{
            deleteOne() {
                const boardNum = Number($("#free-board-detail-board-num").val());
                const userIdx = [[${userIdx}]];
                const dbuserIdx = [[${boardOne.member.userIdx}]];
                if (userIdx!==dbuserIdx){
                    alert("삭제실패");
                }else {
                    $.ajax({
                        url: '/v1/delete/' + boardNum,
                        contentType: "application/json; charset=utf-8",
                        success: window.location.href = '/board'
                    });
                };
            };

        }
    </script>
</section>
</body>
</html>